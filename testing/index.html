<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VPINHUB Golden Tee Ballers - Home</title>
    <link href="https://fonts.googleapis.com/css2?family=Rajdhani:wght@400;600;700&family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        /* --- CSS STYLES --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary-orange: #FF6B00;
            --dark-orange: #CC5500;
            --black: #000000;
            --dark-gray: #1a1a1a;
            --medium-gray: #2a2a2a;
            --light-gray: #3a3a3a;
            --text-gray: #cccccc;
        }
        body {
            font-family: 'Poppins', sans-serif;
            background: var(--black);
            color: var(--text-gray);
            line-height: 1.6;
            overflow-x: hidden;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Rajdhani', sans-serif;
            font-weight: 700;
            color: #ffffff;
        }
        /* Navigation */
        .navbar {
            background: linear-gradient(180deg, var(--dark-gray) 0%, var(--black) 100%);
            padding: 1rem 0;
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 2px solid var(--primary-orange);
        }
        .nav-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .logo {
            font-size: 1.8em;
            font-weight: 700;
            color: var(--primary-orange);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .logo span { color: #ffffff; }
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 2rem;
        }
        .nav-menu a {
            color: var(--text-gray);
            text-decoration: none;
            font-weight: 500;
            transition: color 0.3s;
            position: relative;
        }
        .nav-menu a:hover, .nav-menu a.active { color: var(--primary-orange); }
        .nav-menu a::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--primary-orange);
            transition: width 0.3s;
        }
        .nav-menu a:hover::after { width: 100%; }
        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--dark-gray) 0%, var(--black) 100%);
            padding: 4rem 2rem;
            text-align: center;
            border-bottom: 3px solid var(--primary-orange);
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: 'üèåÔ∏è';
            position: absolute;
            font-size: 15em;
            opacity: 0.03;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        .hero-content {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        .hero h1 {
            font-size: 3.5em;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 2px;
        }
        .hero .highlight { color: var(--primary-orange); }
        .hero p { font-size: 1.3em; margin-bottom: 2rem; }
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background: var(--primary-orange);
            color: #ffffff;
            text-decoration: none;
            border-radius: 5px;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid var(--primary-orange);
        }
        .btn:hover { background: transparent; color: var(--primary-orange); }
        .btn-secondary {
            background: transparent;
            border: 2px solid var(--primary-orange);
            color: var(--primary-orange);
        }
        .btn-secondary:hover { background: var(--primary-orange); color: #ffffff; }
        /* Container & Sections */
        .container { max-width: 1400px; margin: 0 auto; padding: 0 2rem; }
        .section { padding: 4rem 0; }
        .section-header { text-align: center; margin-bottom: 3rem; }
        .section-header h2 {
            font-size: 2.5em;
            margin-bottom: 0.5rem;
            position: relative;
            display: inline-block;
        }
        .section-header h2::after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 3px;
            background: var(--primary-orange);
        }
        .section-header p { font-size: 1.1em; color: var(--text-gray); }
        /* Spotlight */
        .spotlight {
            background: var(--dark-gray);
            border-radius: 15px;
            padding: 2rem;
            border: 2px solid var(--light-gray);
        }
        .spotlight h3 {
            font-size: 2em;
            margin-bottom: 1.5rem;
            text-align: center;
            color: var(--primary-orange);
        }
        .video-container {
            position: relative;
            width: 100%;
            max-width: 800px;
            margin: 0 auto 1rem;
            padding-bottom: 56.25%;
            height: 0;
            border-radius: 10px;
            overflow: hidden;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        .spotlight-info { text-align: center; padding: 1rem; }
        .spotlight-info .player-name {
            font-size: 1.5em;
            color: var(--primary-orange);
            font-weight: 600;
        }
        /* Leaderboard Components */
        .leaderboard-preview {
            background: var(--dark-gray);
            border-radius: 15px;
            overflow: hidden;
            border: 2px solid var(--light-gray);
        }
        .game-tabs {
            display: flex;
            background: var(--medium-gray);
            border-bottom: 2px solid var(--primary-orange);
            overflow-x: auto;
        }
        .tab {
            padding: 1rem 2rem;
            background: transparent;
            border: none;
            color: var(--text-gray);
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            white-space: nowrap;
            border-bottom: 3px solid transparent;
        }
        .tab:hover { background: var(--light-gray); }
        .tab.active {
            background: var(--light-gray);
            color: var(--primary-orange);
            border-bottom-color: var(--primary-orange);
        }
        .leaderboard-content { padding: 2rem; }
        table { width: 100%; border-collapse: collapse; }
        thead { background: var(--medium-gray); }
        th {
            padding: 1rem;
            text-align: left;
            color: var(--primary-orange);
            font-weight: 600;
            border-bottom: 2px solid var(--primary-orange);
        }
        td { padding: 1rem; border-bottom: 1px solid var(--light-gray); }
        tbody tr { transition: background 0.3s; cursor: pointer; }
        tbody tr:hover { background: var(--medium-gray); }
        .rank { font-weight: 700; font-size: 1.2em; }
        .rank-1 { color: #FFD700; }
        .rank-2 { color: #C0C0C0; }
        .rank-3 { color: #CD7F32; }
        .player-name { font-weight: 600; color: #ffffff; }
        .score-highlight { color: var(--primary-orange); font-weight: 700; font-size: 1.1em; }
        .video-icon { color: var(--primary-orange); font-size: 1.2em; }
        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .stat-card {
            background: var(--dark-gray);
            padding: 2rem;
            border-radius: 10px;
            text-align: center;
            border: 2px solid var(--light-gray);
            transition: transform 0.3s, border-color 0.3s;
            cursor: pointer;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-orange);
        }
        .stat-card .stat-number {
            font-size: 3em;
            color: var(--primary-orange);
            font-weight: 700;
            display: block;
        }
        .stat-card .stat-label {
            font-size: 1.1em;
            color: var(--text-gray);
            margin-top: 0.5rem;
        }
        /* Player Card */
        .player-card {
            background: var(--dark-gray);
            border-radius: 15px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 2px solid var(--light-gray);
            transition: border-color 0.3s;
        }
        .player-card:hover { border-color: var(--primary-orange); }
        .player-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid var(--light-gray);
        }
        .player-rank { font-size: 3em; font-weight: 700; min-width: 80px; }
        .player-details { flex: 1; margin-left: 2rem; }
        .player-details h3 { font-size: 2em; margin-bottom: 0.5rem; }
        .player-stats { display: flex; gap: 2rem; color: var(--text-gray); }
        .scorecard-video-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-top: 1.5rem;
        }
        .scorecard-compact { overflow-x: auto; }
        .scorecard-compact table { font-size: 0.9em; }
        /* Footer */
        .footer {
            background: var(--dark-gray);
            border-top: 3px solid var(--primary-orange);
            padding: 3rem 0 1rem;
            margin-top: 4rem;
        }
        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2rem;
            margin-bottom: 2rem;
        }
        .footer-section h3 { color: var(--primary-orange); margin-bottom: 1rem; }
        .footer-section ul { list-style: none; }
        .footer-section ul li { margin-bottom: 0.5rem; }
        .footer-section a {
            color: var(--text-gray);
            text-decoration: none;
            transition: color 0.3s;
        }
        .footer-section a:hover { color: var(--primary-orange); }
        .footer-bottom {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--light-gray);
            color: var(--text-gray);
        }
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            overflow-y: auto;
            padding: 2rem;
        }
        .modal.active { display: flex; align-items: center; justify-content: center; }
        .modal-content {
            background: var(--dark-gray);
            border-radius: 15px;
            padding: 2rem;
            max-width: 1200px;
            width: 100%;
            position: relative;
            border: 2px solid var(--primary-orange);
        }
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--primary-orange);
            border: none;
            color: #ffffff;
            font-size: 1.5em;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover { background: var(--dark-orange); }
        .scorecard-table { width: 100%; margin-top: 2rem; overflow-x: auto; }
        .scorecard-table th { background: var(--medium-gray); padding: 0.75rem; text-align: center; }
        .scorecard-table td { text-align: center; padding: 0.75rem; }
        
        /* Mobile Breakpoints */
        @media (max-width: 1024px) {
            .scorecard-video-grid { grid-template-columns: 1fr; }
        }
        @media (max-width: 768px) {
            .hero h1 { font-size: 2em; }
            .nav-menu { flex-direction: column; gap: 0.5rem; }
            .game-tabs { flex-direction: column; }
            table { font-size: 0.9em; }
            th, td { padding: 0.5rem; }
        }
        .loading { text-align: center; padding: 3rem; color: var(--text-gray); }
        .no-data { text-align: center; padding: 3rem; color: var(--text-gray); font-size: 1.2em; }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="#" class="logo">VPINHUB <span>GT Ballers</span></a>
            <ul class="nav-menu">
                <li><a href="#" class="active">Home</a></li>
                <li><a href="#weekly">Weekly Challenge</a></li>
                <li><a href="#leaderboard">Rankings</a></li>
                <li><a href="#players">Players</a></li>
                <li><a href="#courses">Courses</a></li>
                <li><a href="#videos">Videos</a></li>
            </ul>
        </div>
    </nav>

    <section class="hero">
        <div class="hero-content">
            <h1><span class="highlight">VPINHUB</span> Golden Tee Ballers</h1>
            <p>Compete. Dominate. Rise through the ranks.</p>
            <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap;">
                <a href="#leaderboard" class="btn">View Leaderboard</a>
                <a href="#" onclick="showJoinModal()" class="btn btn-secondary">Join Leaderboard</a>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <span class="stat-number" id="totalPlayers">-</span>
                    <span class="stat-label">Total Players</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalRounds">-</span>
                    <span class="stat-label">Rounds Played</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="totalVideos">-</span>
                    <span class="stat-label">Video Submissions</span>
                </div>
                <div class="stat-card">
                    <span class="stat-number" id="bestScore">-</span>
                    <span class="stat-label" id="bestScoreDetails">Current Best Round</span>
                </div>
            </div>
        </div>
    </section>

    <section class="section" id="weekly">
        <div class="container">
            <div class="section-header">
                <h2>üèÜ Weekly Challenge Course</h2>
                <p id="weeklyCourseName">Coconut Beach</p>
                <p id="weeklyDateRange" style="font-size: 0.9em; opacity: 0.8; margin-top: 0.5rem;">Loading week range...</p>
            </div>

            <div class="leaderboard-preview">
                <div class="leaderboard-content" id="weeklyContent">
                    <div class="loading">Loading weekly challenge...</div>
                </div>
            </div>
        </div>
    </section>

    <section class="section">
        <div class="container">
            <div class="spotlight">
                <h3>üé¨ Random Player Spotlight</h3>
                <div id="spotlightContent">
                    <div class="loading">Loading spotlight...</div>
                </div>
            </div>
        </div>
    </section>

    <section class="section" id="players">
        <div class="container">
            <div class="section-header">
                <h2>Players</h2>
                <p>Top performers ranked by best round</p>
            </div>

            <div id="playersContent">
                <div class="loading">Loading players...</div>
            </div>
        </div>
    </section>

    <section class="section" id="courses">
        <div class="container">
            <div class="section-header">
                <h2>Courses</h2>
                <p>All played courses with best video submissions</p>
            </div>

            <div class="leaderboard-preview">
                <div class="leaderboard-content" id="coursesContent">
                    <div class="loading">Loading courses...</div>
                </div>
            </div>
        </div>
    </section>

    <section class="section" id="videos">
        <div class="container">
            <div class="section-header">
                <h2>Video Submissions</h2>
                <p>Best performances ranked by score</p>
            </div>

            <div class="leaderboard-preview">
                <div class="leaderboard-content" id="videosContent">
                    <div class="loading">Loading videos...</div>
                </div>
            </div>
        </div>
    </section>

    <section class="section" id="leaderboard">
        <div class="container">
            <div class="section-header">
                <h2>Current Leaderboard</h2>
                <p>Top performers across all Golden Tee games</p>
            </div>

            <div class="leaderboard-preview">
                <div class="game-tabs" id="gameTabs">
                    <div class="loading">Loading games...</div>
                </div>
                <div class="leaderboard-content" id="leaderboardContent">
                    <div class="loading">Select a game to view rankings</div>
                </div>
            </div>
        </div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>About</h3>
                    <p>VPINHUB Golden Tee Ballers - Where the best compete in TeknoParrot's Golden Tee tournaments.</p>
                </div>
                <div class="footer-section">
                    <h3>Quick Links</h3>
                    <ul>
                        <li><a href="#">Home</a></li>
                        <li><a href="#leaderboard">Rankings</a></li>
                        <li><a href="#players">Players</a></li>
                        <li><a href="#courses">Courses</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Community</h3>
                    <ul>
                        <li><a href="https://discord.gg/teknoparrot" target="_blank">Discord</a></li>
                        <li><a href="https://teknoparrot.com" target="_blank">TeknoParrot</a></li>
                        <li><a href="#">Videos</a></li>
                    </ul>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2025 VPINHUB Golden Tee Ballers. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <div class="modal" id="joinModal">
        <div class="modal-content" style="max-width: 600px;">
            <button class="modal-close" onclick="closeJoinModal()">√ó</button>
            <h2 style="color: var(--primary-orange); margin-bottom: 1.5rem;">Join the Leaderboard</h2>
            <div style="line-height: 2; font-size: 1.1em;">
                <p style="margin-bottom: 1rem;">Follow these steps to join the VPINHUB Golden Tee Ballers leaderboard:</p>
                <ol style="margin-left: 1.5rem; margin-bottom: 1.5rem;">
                    <li>Visit <a href="https://vpinhub.com" target="_blank" style="color: var(--primary-orange); text-decoration: none; font-weight: 600;">vpinhub.com</a></li>
                    <li>Join our <strong style="color: var(--primary-orange);">Discord</strong> server</li>
                    <li>Message <strong style="color: var(--primary-orange);">Paladin</strong> to be added to the leaderboard</li>
                </ol>
                <p style="background: var(--medium-gray); padding: 1rem; border-radius: 8px; border-left: 4px solid var(--primary-orange);">
                    <strong>Note:</strong> TeknoParrot Premium is required for score submission
                </p>
            </div>
        </div>
    </div>

    <div class="modal" id="scorecardModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">√ó</button>
            <div id="modalContent"></div>
        </div>
    </div>

    <script>
        let leaderboardData = [];
        let bestRoundEntry = null;

        // Weekly Challenge Configuration
        const WEEKLY_CHALLENGE_COURSE = "Coconut Beach"; 

        // Auto-load data on page load
        window.addEventListener('DOMContentLoaded', function() {
            loadJSONFile('golden_tee_leaderboard.json');
        });

        function loadJSONFile(filename) {
            fetch(filename + '?v=' + new Date().getTime())
                .then(response => response.json())
                .then(data => {
                    leaderboardData = data;
                    initializeLeaderboards();
                    updateStats();
                    showRandomSpotlight();
                    showWeeklyChallenge();
                    showPlayers();
                    showCourses();
                    showVideos();
                })
                .catch(error => {
                    console.error('Error loading data:', error);
                    document.getElementById('spotlightContent').innerHTML = '<div class="no-data">Unable to load data. Please check if golden_tee_leaderboard.json exists.</div>';
                });
        }

        function parseDate(dateStr) {
            if (!dateStr) return null;
            const parts = dateStr.trim().split(' ');
            const datePart = parts[0];
            const timePart = parts[1];
            const ampm = parts[2];
            let day, month, year;

            if (datePart.includes('-')) {
                const dateComponents = datePart.split('-');
                if (dateComponents.length !== 3) return null;
                day = parseInt(dateComponents[0], 10);
                month = parseInt(dateComponents[1], 10) - 1;
                year = parseInt(dateComponents[2], 10);
            } else {
                const dateComponents = datePart.split('/');
                if (dateComponents.length !== 3) return null;
                month = parseInt(dateComponents[0], 10) - 1;
                day = parseInt(dateComponents[1], 10);
                year = parseInt(dateComponents[2], 10);
            }

            if (year < 100) year += 2000;
            let hours = 0, minutes = 0, seconds = 0;
            if (timePart) {
                const timeComponents = timePart.split(':');
                if (timeComponents.length >= 2) {
                    hours = parseInt(timeComponents[0], 10);
                    minutes = parseInt(timeComponents[1], 10);
                    seconds = timeComponents.length > 2 ? parseInt(timeComponents[2], 10) : 0;
                    if (ampm) {
                        const upperAmpm = ampm.toUpperCase();
                        if (upperAmpm === 'PM' && hours < 12) hours += 12;
                        if (upperAmpm === 'AM' && hours === 12) hours = 0;
                    }
                }
            }
            const d = new Date(year, month, day, hours, minutes, seconds);
            return isNaN(d.getTime()) ? null : d;
        }

        function showWeeklyChallenge() {
            const now = new Date();
            const et = new Date(now.toLocaleString('en-US', { timeZone: 'America/New_York' }));
            
            // Set weekStart to the most recent Friday at 12pm ET
            let weekStart = new Date(et);
            weekStart.setHours(12, 0, 0, 0);
            const dayNum = weekStart.getDay(); 
            const daysSinceFriday = (dayNum >= 5) ? (dayNum - 5) : (dayNum + 2);
            weekStart.setDate(weekStart.getDate() - daysSinceFriday);
            
            // If it's currently Friday before 12pm, move back one week
            if (et.getDay() === 5 && et.getHours() < 12) {
                weekStart.setDate(weekStart.getDate() - 7);
            }

            const weekEnd = new Date(weekStart);
            weekEnd.setDate(weekEnd.getDate() + 7);

            const options = { month: 'short', day: 'numeric', year: 'numeric' };
            const startStr = weekStart.toLocaleDateString('en-US', options);
            const endStr = weekEnd.toLocaleDateString('en-US', options);
            document.getElementById('weeklyDateRange').textContent = `${startStr} 12pm ET - ${endStr} 12pm ET`;
            document.getElementById('weeklyCourseName').textContent = WEEKLY_CHALLENGE_COURSE;

            // FILTER LOGIC: Adjusted to capture entries even if they are slightly ahead of system time (e.g., Jan 24 entries)
            const allWeeklyEntries = leaderboardData.filter(entry => {
                if (entry.course !== WEEKLY_CHALLENGE_COURSE) return false;
                const entryDate = parseDate(entry.date);
                if (!entryDate) return false;
                
                // Keep entries that are within the week window or very recently after the week window 
                // (allowing for time skew up to 24 hours in the "future" for current sessions)
                const extendedNow = new Date(et.getTime() + (24 * 60 * 60 * 1000));
                return entryDate >= weekStart && entryDate <= extendedNow;
            });

            const playerBestScores = {};
            allWeeklyEntries.forEach(entry => {
                const player = entry.username || 'Unknown';
                const score = parseInt(entry.total_score, 10);
                if (isNaN(score)) return;
                if (!playerBestScores[player] || score < parseInt(playerBestScores[player].total_score, 10)) {
                    playerBestScores[player] = entry;
                }
            });

            const weeklyEntries = Object.values(playerBestScores);
            weeklyEntries.sort((a, b) => {
                const scoreA = parseInt(a.total_score, 10) || 999;
                const scoreB = parseInt(b.total_score, 10) || 999;
                return scoreA - scoreB;
            });

            const container = document.getElementById('weeklyContent');
            if (weeklyEntries.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <p style="font-size: 1.5em; margin-bottom: 1rem;">No entries yet for this week's challenge!</p>
                        <p>Be the first to play <strong style="color: var(--primary-orange);">${WEEKLY_CHALLENGE_COURSE}</strong> and submit your score.</p>
                    </div>
                `;
                return;
            }

            let html = `
                <div style="text-align: center; margin-bottom: 2rem; padding: 1.5rem; background: var(--medium-gray); border-radius: 10px; border: 2px solid var(--primary-orange);">
                    <h3 style="color: var(--primary-orange); margin-bottom: 0.5rem;">Current Week's Challenge</h3>
                    <p style="font-size: 1.2em;"><strong>${WEEKLY_CHALLENGE_COURSE}</strong></p>
                    <p style="font-size: 0.9em; opacity: 0.8;">${weeklyEntries.length} player${weeklyEntries.length === 1 ? '' : 's'} competing this week</p>
                </div>
                <table>
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>Player</th>
                            <th>Score</th>
                            <th>Total</th>
                            <th>Date</th>
                            <th>Video</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            weeklyEntries.forEach((entry, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                const dateObj = parseDate(entry.date);
                const dateStr = dateObj ? dateObj.toLocaleDateString('en-US', { month: 'short', day: 'numeric' }) : 'N/A';

                html += `
                    <tr onclick='showScorecard(${JSON.stringify(entry).replace(/'/g, "&apos;")})' style="cursor: pointer;">
                        <td><span class="rank ${rankClass}">#${index + 1}</span></td>
                        <td><span class="player-name">${entry.username || 'Unknown'}</span></td>
                        <td><span class="score-highlight">${entry.score_vs_par || 'E'}</span></td>
                        <td>${entry.total_score || 'N/A'}</td>
                        <td>${dateStr}</td>
                        <td>${entry.youtube_video ? '<span class="video-icon">üìπ</span>' : ''}</td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function updateStats() {
            const players = new Set(leaderboardData.map(e => e.username)).size;
            const rounds = leaderboardData.length;
            const videos = leaderboardData.filter(e => e.youtube_video).length;
            let bestEntry = null;
            let bestScoreValue = 999;

            leaderboardData.forEach(entry => {
                const score = parseInt(entry.total_score, 10);
                if (!isNaN(score) && score < bestScoreValue) {
                    bestScoreValue = score;
                    bestEntry = entry;
                }
            });

            document.getElementById('totalPlayers').textContent = players;
            document.getElementById('totalRounds').textContent = rounds;
            document.getElementById('totalVideos').textContent = videos;

            if (bestEntry) {
                bestRoundEntry = bestEntry;
                document.getElementById('bestScore').textContent = bestEntry.score_vs_par || 'E';
                document.getElementById('bestScoreDetails').innerHTML = `
                    <strong style="color: var(--primary-orange); font-size: 1.2em;">Best Round</strong><br>
                    ${bestEntry.username || 'Unknown'}<br>
                    ${bestEntry.course || 'Unknown Course'}<br>
                    (${bestEntry.total_score})
                `;
            }
        }

        function showPlayers() {
            const playersMap = {};
            leaderboardData.forEach(entry => {
                const player = entry.username || 'Unknown';
                const score = parseInt(entry.total_score, 10);
                if (!playersMap[player]) {
                    playersMap[player] = { name: player, bestScore: 999, bestEntry: null, totalRounds: 0 };
                }
                playersMap[player].totalRounds++;
                if (!isNaN(score) && score < playersMap[player].bestScore) {
                    playersMap[player].bestScore = score;
                    playersMap[player].bestEntry = entry;
                }
            });

            const players = Object.values(playersMap).filter(p => p.bestEntry).sort((a, b) => a.bestScore - b.bestScore);
            const container = document.getElementById('playersContent');
            if (players.length === 0) {
                container.innerHTML = '<div class="no-data">No players found</div>';
                return;
            }

            let html = '';
            players.forEach((player, index) => {
                const entry = player.bestEntry;
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                html += `
                    <div class="player-card">
                        <div class="player-header">
                            <div class="player-rank ${rankClass}">#${index + 1}</div>
                            <div class="player-details">
                                <h3>${player.name}</h3>
                                <div class="player-stats">
                                    <span><strong>Best Score:</strong> <span class="score-highlight">${entry.score_vs_par || 'E'}</span> (${entry.total_score})</span>
                                    <span><strong>Course:</strong> ${entry.course || 'Unknown'}</span>
                                    <span><strong>Rounds Played:</strong> ${player.totalRounds}</span>
                                </div>
                            </div>
                        </div>
                        <div class="scorecard-video-grid">
                            <div class="scorecard-compact">
                                <h4 style="color: var(--primary-orange); margin-bottom: 1rem;">Best Round Scorecard</h4>
                                ${buildCompactScorecard(entry)}
                            </div>
                            ${entry.youtube_embed ? `
                                <div>
                                    <h4 style="color: var(--primary-orange); margin-bottom: 1rem;">Video Preview</h4>
                                    <div class="video-container">
                                        <iframe src="${entry.youtube_embed}" frameborder="0" allowfullscreen></iframe>
                                    </div>
                                </div>
                            ` : '<div style="display: flex; align-items: center; justify-content: center; opacity: 0.5;">No video available</div>'}
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
        }

        function buildCompactScorecard(entry) {
            if (!entry.players || entry.players.length === 0) return '<p>No scorecard data available</p>';
            const player = entry.players[0];
            const scores = player.scores;
            const pars = entry.pars;
            const holes = entry.holes || [];
            let holeHeaders = [];
            let dataIndices = [];
            for (let i = 1; i < holes.length; i++) {
                if (holes[i] && !isNaN(parseInt(holes[i], 10))) {
                    holeHeaders.push(holes[i]);
                    dataIndices.push(i - 1);
                }
            }
            if (dataIndices.length === 0) return '<p>No hole data available</p>';
            let html = '<table><thead><tr><th>Hole</th>';
            holeHeaders.forEach(h => html += `<th>${h}</th>`);
            html += '<th>Total</th></tr></thead><tbody>';
            if (pars && pars.length > 0) {
                html += '<tr><td><strong>Par</strong></td>';
                dataIndices.forEach(i => html += `<td>${pars[i] || '-'}</td>`);
                html += `<td><strong>${entry.score_vs_par || 'E'}</strong></td></tr>`;
            }
            html += '<tr><td><strong>Score</strong></td>';
            dataIndices.forEach(i => {
                const score = scores[i] || '-';
                const par = pars && pars[i] ? parseInt(pars[i], 10) : null;
                const scoreNum = parseInt(score, 10);
                let style = '';
                if (!isNaN(scoreNum) && par !== null) {
                    if (scoreNum === 1) style = 'color: #FFD700; font-weight: bold;';
                    else {
                        const diff = scoreNum - par;
                        if (diff <= -2) style = 'color: #00BFFF; font-weight: bold;';
                        else if (diff === -1) style = 'color: #00FF00; font-weight: bold;';
                        else if (diff > 0) style = 'color: #FF0000; font-weight: bold;';
                    }
                }
                html += `<td style="${style}">${score}</td>`;
            });
            html += `<td><strong>${entry.total_score || 'N/A'}</strong></td></tr></tbody></table>`;
            return html;
        }

        function showCourses() {
            const coursesMap = {};
            leaderboardData.forEach(entry => {
                const course = entry.course;
                if (!course) return;
                if (!coursesMap[course]) coursesMap[course] = { name: course, bestScore: 999, bestEntry: null };
                const score = parseInt(entry.total_score, 10);
                if (!isNaN(score) && score < coursesMap[course].bestScore) {
                    coursesMap[course].bestScore = score;
                    coursesMap[course].bestEntry = entry;
                }
            });
            const courses = Object.values(coursesMap).sort((a, b) => a.name.localeCompare(b.name));
            const container = document.getElementById('coursesContent');
            if (courses.length === 0) {
                container.innerHTML = '<div class="no-data">No courses found</div>';
                return;
            }
            let html = `<table><thead><tr><th>Course Name</th><th>Best Score</th><th>Player</th><th>Best Video</th></tr></thead><tbody>`;
            courses.forEach(course => {
                const entry = course.bestEntry;
                const hasVideo = entry && entry.youtube_video;
                html += `
                    <tr ${hasVideo ? `onclick='showScorecard(${JSON.stringify(entry).replace(/'/g, "&apos;")})'` : ''} style="${hasVideo ? 'cursor: pointer;' : ''}">
                        <td><strong style="color: #ffffff;">${course.name}</strong></td>
                        <td><span class="score-highlight">${entry?.score_vs_par || 'N/A'}</span> (${entry?.total_score || 'N/A'})</td>
                        <td><span class="player-name">${entry?.username || 'Unknown'}</span></td>
                        <td>${hasVideo ? `<a href="${entry.youtube_video}" target="_blank" onclick="event.stopPropagation()" style="color: var(--primary-orange); text-decoration: none;">üé¨ Watch</a>` : '<span style="opacity: 0.5;">No video</span>'}</td>
                    </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function showVideos() {
            const videoEntries = leaderboardData.filter(entry => entry.youtube_video).sort((a, b) => (parseInt(a.total_score, 10) || 999) - (parseInt(b.total_score, 10) || 999));
            const container = document.getElementById('videosContent');
            if (videoEntries.length === 0) {
                container.innerHTML = '<div class="no-data">No video submissions yet</div>';
                return;
            }
            let html = `<table><thead><tr><th>Rank</th><th>Player</th><th>Game</th><th>Course</th><th>Score</th><th>Video</th></tr></thead><tbody>`;
            videoEntries.forEach((entry, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                html += `
                    <tr onclick='showVideoModal(${JSON.stringify(entry).replace(/'/g, "&apos;")})' style="cursor: pointer;">
                        <td><span class="rank ${rankClass}">#${index + 1}</span></td>
                        <td><span class="player-name">${entry.username || 'Unknown'}</span></td>
                        <td>${entry.game || 'Unknown'}</td>
                        <td>${entry.course || 'Unknown'}</td>
                        <td><span class="score-highlight">${entry.score_vs_par || 'E'}</span> (${entry.total_score || 'N/A'})</td>
                        <td><a href="${entry.youtube_video}" target="_blank" onclick="event.stopPropagation()" style="color: var(--primary-orange); text-decoration: none;">üé¨ Watch</a></td>
                    </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function showVideoModal(entry) { showScorecard(entry); }
        function showJoinModal() { document.getElementById('joinModal').classList.add('active'); }
        function closeJoinModal() { document.getElementById('joinModal').classList.remove('active'); }
        function showRandomSpotlight() {
            const videoEntries = leaderboardData.filter(entry => entry.youtube_embed);
            if (videoEntries.length === 0) {
                document.getElementById('spotlightContent').innerHTML = '<div class="no-data">No videos available</div>';
                return;
            }
            const randomEntry = videoEntries[Math.floor(Math.random() * videoEntries.length)];
            document.getElementById('spotlightContent').innerHTML = `
                <div class="video-container"><iframe src="${randomEntry.youtube_embed}" frameborder="0" allowfullscreen></iframe></div>
                <div class="spotlight-info"><span class="player-name">${randomEntry.username || 'Unknown'}</span> on ${randomEntry.course || 'Unknown Course'}<br>Score: <strong style="color: var(--primary-orange)">${randomEntry.score_vs_par || 'E'}</strong> (${randomEntry.total_score || 'N/A'})</div>`;
        }

        function initializeLeaderboards() {
            const availableGames = [...new Set(leaderboardData.map(entry => entry.game))];
            
            const targetOrder = [
                'Golden Tee Unplugged 2018',
                'Golden Tee Unplugged 2017',
                'Golden Tee Unplugged 2016',
                'Golden Tee Live 2007',
                'Golden Tee Live 2006',
                'Power Putt Live 2013'
            ];

            const filteredGames = targetOrder.filter(gameName => availableGames.includes(gameName));
            createTabs(filteredGames);
            if (filteredGames.length > 0) showGame(filteredGames[0]);
        }

        function createTabs(games) {
            const tabsContainer = document.getElementById('gameTabs');
            tabsContainer.innerHTML = '';
            games.forEach(game => {
                const tab = document.createElement('button');
                tab.className = 'tab';
                tab.textContent = game;
                tab.onclick = () => showGame(game);
                tabsContainer.appendChild(tab);
            });
        }

        function showGame(game) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.toggle('active', tab.textContent === game));
            const entries = leaderboardData.filter(entry => entry.game === game).sort((a, b) => (parseInt(a.total_score, 10) || 999) - (parseInt(b.total_score, 10) || 999)).slice(0, 10);
            displayLeaderboard(entries);
        }

        function displayLeaderboard(entries) {
            const container = document.getElementById('leaderboardContent');
            if (entries.length === 0) {
                container.innerHTML = '<div class="no-data">No entries found</div>';
                return;
            }
            let html = `<table><thead><tr><th>Rank</th><th>Player</th><th>Course</th><th>Score</th><th>Total</th><th>Video</th></tr></thead><tbody>`;
            entries.forEach((entry, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : '';
                html += `
                    <tr onclick='showScorecard(${JSON.stringify(entry).replace(/'/g, "&apos;")})'>
                        <td><span class="rank ${rankClass}">#${index + 1}</span></td>
                        <td><span class="player-name">${entry.username || 'Unknown'}</span></td>
                        <td>${entry.course || 'Unknown'}</td>
                        <td><span class="score-highlight">${entry.score_vs_par || 'E'}</span></td>
                        <td>${entry.total_score || 'N/A'}</td>
                        <td>${entry.youtube_video ? '<span class="video-icon">üìπ</span>' : ''}</td>
                    </tr>`;
            });
            html += '</tbody></table>';
            container.innerHTML = html;
        }

        function showScorecard(entry) {
            const modal = document.getElementById('scorecardModal');
            const content = document.getElementById('modalContent');
            let html = `<h2 style="color: var(--primary-orange)">${entry.game}</h2><h3>${entry.username || 'Unknown'} - ${entry.course || 'Unknown'}</h3><p style="font-size: 1.3em; margin: 1rem 0;"><strong style="color: var(--primary-orange); font-size: 1.5em;">${entry.score_vs_par || 'E'}</strong><span style="opacity: 0.7;">(${entry.total_score || 'N/A'})</span> | ${entry.date || 'Unknown date'}</p>`;
            if (entry.youtube_embed) html += `<div class="video-container"><iframe src="${entry.youtube_embed}" frameborder="0" allowfullscreen></iframe></div>`;
            if (entry.players && entry.players.length > 0) html += buildScorecardTable(entry);
            content.innerHTML = html;
            modal.classList.add('active');
        }

        function buildScorecardTable(entry) {
            const player = entry.players[0];
            const scores = player.scores;
            const pars = entry.pars;
            const holes = entry.holes || [];
            let holeHeaders = [];
            let dataIndices = [];
            for (let i = 1; i < holes.length; i++) {
                if (holes[i] && !isNaN(parseInt(holes[i], 10))) {
                    holeHeaders.push(holes[i]);
                    dataIndices.push(i - 1);
                }
            }
            if (dataIndices.length === 0) return '';
            let html = '<div class="scorecard-table"><table><thead><tr><th>Hole</th>';
            holeHeaders.forEach(h => html += `<th>${h}</th>`);
            html += '<th>Total</th></tr></thead><tbody>';
            if (pars && pars.length > 0) {
                html += '<tr><td><strong>Par</strong></td>';
                dataIndices.forEach(i => html += `<td>${pars[i] || '-'}</td>`);
                html += `<td><strong>${entry.score_vs_par || 'E'}</strong></td></tr>`;
            }
            html += '<tr><td><strong>Score</strong></td>';
            dataIndices.forEach(i => {
                const score = scores[i] || '-';
                const par = pars && pars[i] ? parseInt(pars[i], 10) : null;
                const scoreNum = parseInt(score, 10);
                let style = '';
                if (!isNaN(scoreNum) && par !== null) {
                    if (scoreNum === 1) style = 'color: #FFD700; font-weight: bold;';
                    else {
                        const diff = scoreNum - par;
                        if (diff <= -2) style = 'color: #00BFFF; font-weight: bold;';
                        else if (diff === -1) style = 'color: #00FF00; font-weight: bold;';
                        else if (diff > 0) style = 'color: #FF0000; font-weight: bold;';
                    }
                }
                html += `<td style="${style}">${score}</td>`;
            });
            html += `<td><strong>${entry.total_score || 'N/A'}</strong></td></tr></tbody></table></div>`;
            return html;
        }

        function closeModal() { document.getElementById('scorecardModal').classList.remove('active'); }
        document.getElementById('scorecardModal').addEventListener('click', function(e) { if (e.target === this) closeModal(); });
        document.getElementById('joinModal').addEventListener('click', function(e) { if (e.target === this) closeJoinModal(); });
    </script>
</body>
</html>
